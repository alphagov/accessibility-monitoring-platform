{% extends "base.html" %}

{% block title %}Dashboard | {{ page_title }}{% endblock %}

{% block content %}
<div class="govuk-width-container">
    <main id="main-content" class="govuk-main-wrapper dashboard">
        <div class="govuk-body">
            <strong class="govuk-tag govuk-!-margin-top-4 govuk-!-margin-bottom-4">
                Experimental
            </strong>
            &nbsp Status is programatically assigned and may label cases incorrectly
        </div>
        {% if recent_changes_to_platform %}
            <div class="govuk-grid-row">
                <div class="govuk-grid-column-full">
                    <div class="govuk-warning-text">
                        <span class="govuk-warning-text__icon" aria-hidden="true">!</span>
                        <strong class="govuk-warning-text__text">
                            <span class="govuk-warning-text__assistive">Warning</span>
                            An update has been made to the platform. View the update in
                            <a href="{% url 'common:platform-history' %}" class="govuk-link govuk-link--no-visited-state">
                                Settings > Platform version history</a>
                        </strong>
                    </div>
                </div>
            </div>
        {% endif %}
        <div class="govuk-grid-row">
            {% if mfa_disabled %}
                <div class="govuk-notification-banner" role="region" aria-labelledby="govuk-notification-banner-title" data-module="govuk-notification-banner">
                    <div class="govuk-notification-banner__header">
                      <h2 class="govuk-notification-banner__title" id="govuk-notification-banner-title">
                        Important
                      </h2>
                    </div>
                    <div class="govuk-notification-banner__content">
                        <h3 class="govuk-notification-banner__heading">
                            Two-factor authentication has not been setup for your account.
                        </h3>
                        <p class="govuk-body">
                            Enable in 2FA in <a class="govuk-notification-banner__link" href="{% url 'users:edit-user' request.user.id %}">Settings > Account details</a>.
                        </p>
                    </div>
                </div>
            {% endif %}

            <div class="govuk-grid-column-one-third">
                <h1 class="govuk-heading-xl">{{ page_title }}</h1>
            </div>
            <div class="govuk-grid-column-two-thirds">
                <a
                    href="{% url 'cases:case-create' %}"
                    role="button"
                    draggable="false"
                    class="govuk-button float-right amp-margin-left-10"
                    data-module="govuk-button"
                >
                    Create case
                </a>
                <a
                    href="{% url 'cases:case-list' %}?status=unassigned-case"
                    role="button"
                    draggable="false"
                    class="govuk-button govuk-button--secondary float-right amp-margin-left-10"
                    data-module="govuk-button"
                >
                    View unassigned cases
                </a>
                {% if show_all_cases %}
                    <form method="get" action="{% url 'dashboard:home' %}">
                        <input
                            type="submit"
                            value="View your cases"
                            name="view"
                            class="govuk-button govuk-button--secondary float-right"
                            data-module="govuk-button"
                        />
                    </form>
                {% else %}
                    <form method="get" action="{% url 'dashboard:home' %}">
                        <input
                            type="submit"
                            value="View all cases"
                            name="view"
                            class="govuk-button govuk-button--secondary float-right"
                            data-module="govuk-button"
                        />
                    </form>
                {% endif %}
            </div>
        </div>
        <div class="govuk-grid-row insert-margin">
            <div class="govuk-grid-column-one-quarter">
                <div class="govuk-body-m">
                    Total active cases
                </div>
                <div class="govuk-heading-xl no-bottom-margin">
                    {{total_incomplete_cases}}
                </div>
            </div>
            <div class="govuk-grid-column-one-quarter leftborder">
                <div class="govuk-body-m">
                    Your active cases
                </div>
                <div class="govuk-heading-xl no-bottom-margin">
                    {{total_your_active_cases}}
                </div>
            </div>
            <div class="govuk-grid-column-one-quarter leftborder">
                <div class="govuk-body-m">
                    Unassigned cases
                </div>
                <div class="govuk-heading-xl no-bottom-margin">
                    {{total_unassigned_cases}}
                </div>
            </div>
            <div class="govuk-grid-column-one-quarter leftborder">
                <div class="govuk-body-m">
                    {% if show_all_cases %}
                        Unassigned QA cases
                    {% else %}
                        On call
                    {% endif%}
                </div>
                <div class="govuk-heading-xl no-bottom-margin">
                    {% if show_all_cases %}
                        {{total_ready_to_qa_cases}}
                    {% elif platform.active_qa_auditor %}
                        {{ platform.active_qa_auditor.first_name }}
                    {% else %}
                        None
                    {% endif%}
                </div>
            </div>
        </div>
        {% include "./list_view.html" %}
    </main>
</div>

{% endblock %}
