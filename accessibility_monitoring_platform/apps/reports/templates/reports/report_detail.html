{% extends 'base.html' %}

{% load common_tags %}

{% block title %}{{ audit.case.organisation_name }} | View report{% endblock %}

{% block content %}
<div class="govuk-width-container">
    <div class="govuk-breadcrumbs">
        <ol class="govuk-breadcrumbs__list">
            <li class="govuk-breadcrumbs__list-item">
                <a class="govuk-breadcrumbs__link" href="{% url 'dashboard:home' %}">Home</a>
            </li>
            <li class="govuk-breadcrumbs__list-item">
                <a class="govuk-breadcrumbs__link" href="{% url 'cases:case-detail' report.case.id %}">Case</a>
            </li>
            <li class="govuk-breadcrumbs__list-item">
                View report
            </li>
        </ol>
    </div>
    <main id="main-content" class="govuk-main-wrapper no-padding-top">
        <div class="govuk-grid-row">
            <div class="govuk-grid-column-one-half">
                <div class="govuk-button-group" style="display: flex;">
                    <h1 class="govuk-heading-xl" style="margin-bottom:15px; padding-right: 20px;">View report</h1>
                </div>
            </div>
            <div class="govuk-grid-column-one-half">
                <div class="govuk-button-group" style="justify-content:flex-end; margin-top: 4px;">
                    <a
                        href="{% url 'reports:report-rebuild' report.id %}"
                        role="button"
                        draggable="false"
                        class="govuk-button govuk-button--warning"
                        data-module="govuk-button"
                    >
                        Rebuild report
                    </a>
                    <a
                        href="{% url 'reports:report-preview' report.id %}"
                        role="button"
                        draggable="false"
                        class="govuk-button govuk-button--secondary"
                        data-module="govuk-button"
                        target="_blank"
                    >
                        Preview
                    </a>
                    <a href="{% url 'reports:edit-report-metadata' report.id %}"
                        role="button"
                        draggable="false"
                        class="govuk-button"
                        data-module="govuk-button"
                    >
                        Publish HTML report
                    </a>
                </div>
            </div>
        </div>
        <div style="position: relative; top: -15px;">
            {% include 'cases/helpers/case_title.html' with case=report.case %}
            {% include "cases/helpers/messages.html" %}
        </div>

        <div class="govuk-grid-row">
            <div class="govuk-grid-column-full">
                {% include 'reports/helpers/nav_contents.html' %}
                {% include 'reports/details/metadata.html' %}
                {% for section in report.section_set.all %}
                    <div class="govuk-grid-row">
                        <div class="govuk-grid-column-two-thirds">
                            <h2 id="{{ section.anchor }}" class="govuk-heading-l">{{ section.name }}</h2>
                        </div>
                        <div class="govuk-grid-column-one-thirds">
                            <div class="govuk-button-group" style="flex-direction:row-reverse">
                                <a href="{% url 'reports:edit-report-section' section.id %}"
                                    class="govuk-link govuk-link--no-visited-state"
                                    rel="noreferrer noopener">
                                    Edit
                                </a>
                            </div>
                        </div>
                    </div>
                    <div class="govuk-grid-row" style="margin-bottom:30px;">
                        <div class="govuk-grid-column-full amp-report">
                            {% if section.template_type == 'html' %}
                                {{ section.content|safe }}
                            {% else %}
                                {{ section.content|markdown_to_html }}
                            {% endif %}
                            {% if section.template_type == 'urls' and section.tablerow_set.all %}
                                <table id="urls-table" caption="Names and URLs of pages we checked">
                                    <thead>
                                        <tr>
                                            <th id="name">Page Name</th>
                                            <th id="url">URL</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% for row in section.tablerow_set.all %}
                                            <tr valign="top" >
                                                <th headers="name">{{ row.cell_content_1|markdown_to_html }}</th>
                                                <td headers="url">{{ row.cell_content_2|markdown_to_html }}</td>
                                            </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            {% endif %}
                            {% if section.template_type == 'issues' and section.tablerow_set.all %}
                                <table id="issues-table" caption="Names and URLs of pages we checked">
                                    <thead>
                                        <tr>
                                            <th id="name">Issue and description</th>
                                            <th id="url">Where the issue was found</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% for row in section.tablerow_set.all %}
                                            <tr valign="top" >
                                                <td headers="name">{{ row.cell_content_1|markdown_to_html }}</th>
                                                <td headers="url">{{ row.cell_content_2|markdown_to_html }}</td>
                                            </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            {% endif %}
                        </div>
                    </div>
                {% endfor %}
            </div>
        </div>
    </main>
</div>
{% endblock %}
