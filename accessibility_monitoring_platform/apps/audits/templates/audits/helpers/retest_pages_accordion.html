{% load common_tags %}

<div class="govuk-accordion" data-module="govuk-accordion" id="accordion-default-axe">
    {% for page in audit.testable_pages %}
        <div class="govuk-accordion__section">
            <div class="govuk-accordion__section-header">
                <h2 class="govuk-accordion__section-heading">
                    <span class="govuk-accordion__section-button" id="accordion-section-{{ forloop.counter0 }}">
                        {{ page }} - {{ page.failed_check_results|length }}
                    </span>
                </h2>
            </div>
            <div id="accordion-section-{{ forloop.counter0 }}" class="govuk-accordion__section-content" aria-labelledby="accordion-section-{{ forloop.counter0 }}">
                <div class="govuk-grid-row">
                    <div class="govuk-grid-column-full govuk-button-group bottom-margin-5">
                        <a href="{% url 'audits:edit-audit-retest-page-checks' page.id %}" style="margin-bottom:0" class="govuk-link govuk-link--no-visited-state">
                            Edit retest
                        </a>
                        <a href="{{ page.url }}" style="margin-bottom:0" class="govuk-link" target="_blank">
                            Link to {% if page.page_type == 'pdf' %}{{ page }}{% else %}{{ page|lower }}{% endif %}
                        </a>
                    </div>
                </div>
                {% if page.failed_check_results %}
                    <table class="govuk-table view-test-accordion-table">
                        <tbody class="govuk-table__body">
                            <tr class="govuk-table__row">
                                <th scope="row" class="govuk-table__header amp-width-one-half">Original test</th>
                                <th scope="row" class="govuk-table__header amp-width-one-half">12-week retest</th>
                            </tr>
                            {% for check_result in page.failed_check_results %}
                                <tr class="govuk-table__row">
                                    <td class="govuk-table__cell amp-width-one-half">
                                        <label class="govuk-label"><b>{{ check_result.wcag_definition }}</b></label>
                                        <div class="govuk-hint">{{ check_result.notes|markdown_to_html }}</div>
                                    </td>
                                    <td class="govuk-table__cell amp-width-one-half">
                                        <label class="govuk-label"><b>{{ check_result.get_retest_state_display }}</b></label>
                                        <div class="govuk-hint">{{ check_result.retest_notes|markdown_to_html }}</div>
                                    </td>
                                </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                {% else %}
                    <p class="govuk-body-m">No errors were found</p>
                {% endif %}
            </div>
        </div>
    {% endfor %}
</div>
