<!DOCTYPE html>

{% extends 'base.html' %}

{% load l10n %}

{% block title %}{{ audit.case.organisation_name }} | Edit test | Report text{% endblock %}

{% block content %}
<div class="govuk-width-container">
    <div class="govuk-breadcrumbs">
        <ol class="govuk-breadcrumbs__list">
            <li class="govuk-breadcrumbs__list-item">
                <a class="govuk-breadcrumbs__link" href="{% url 'dashboard:home' %}">Home</a>
            </li>
            <li class="govuk-breadcrumbs__list-item">
                <a class="govuk-breadcrumbs__link" href="{% url 'cases:case-detail' audit.case.id %}">Case</a>
            </li>
            <li class="govuk-breadcrumbs__list-item">
                <a class="govuk-breadcrumbs__link" href="{% url 'audits:audit-detail' audit.id %}">Test</a>
            </li>
            <li class="govuk-breadcrumbs__list-item">
                Edit test | Report text
            </li>
        </ol>
    </div>
    <main id="main-content" class="govuk-main-wrapper no-padding-top">
        <div class="govuk-grid-row">
            <div class="govuk-grid-column-full">
                {% include "cases/helpers/edit_header.html" with page_heading='Edit test | Report text' case=audit.case %}
            </div>
        </div>
        <div class="govuk-grid-row">
            <div class="govuk-grid-column-two-thirds">
                {% include 'common/error_summary.html' %}
                <h2 class="govuk-heading-m">Contents</h2>
                <ul class="govuk-list">
                    <li>
                        <a href="#pages" class="govuk-link govuk-link--no-visited-state">Pages we checked</a>
                    </li>
                    <li>
                        <a href="#issues" class="govuk-link govuk-link--no-visited-state">The issues we found</a>
                    </li>
                    <li>
                        <a href="#statement" class="govuk-link govuk-link--no-visited-state">Accessibility statement</a>
                    </li>
                    <li>
                        <a href="#what-next" class="govuk-link govuk-link--no-visited-state">What to do next</a>
                    </li>
                    <li>
                        <a href="#all-issues" class="govuk-link govuk-link--no-visited-state">All issues</a>
                    </li>
                </ul>
                <h2 class="govuk-heading-l">Report text</h2>
                <h3 id="pages" class="govuk-heading-m">Pages we checked</h3>
                <table class="govuk-table" style="border:1px solid black;border-collapse:collapse;">
                    <thead>
                        <tr style="border:1px solid black;">
                            <th style="border:1px solid black;text-align:left;">Page name</th>
                            <th style="border:1px solid black;text-align:left;">URL</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for page in audit.every_page_except_all %}
                            <tr style="border:1px solid black;">
                                <td style="border:1px solid black;">{{ page }}</td>
                                <td style="border:1px solid black;"><a href="page.url" target="_blank">
                                    {{ page.url }}</a></td>
                            </tr>
                            {% endfor %}
                    </tbody>
                </table>
                <h3 id="issues" class="govuk-heading-m">The issues we found</h3>
                <table class="govuk-table" style="border:1px solid black;border-collapse:collapse;">
                    <thead>
                        <tr style="border:1px solid black;">
                            <th style="border:1px solid black;text-align:left;">Issue and description</th>
                            <th style="border:1px solid black;text-align:left;">Where the issue was found</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for check_result in audit.failed_check_results %}
                            <tr style="border:1px solid black;">
                                <td style="border:1px solid black;">
                                    <p>
                                        {% if check_result.wcag_definition.url_on_w3 %}
                                            <a href="{{ check_result.wcag_definition.url_on_w3 }}" target="_blank">
                                                {{ check_result.wcag_definition }}</a>
                                        {% else %}
                                            {{ check_result.wcag_definition }}
                                        {% endif %}
                                    </p>
                                    <p class="cases-notes">{{ check_result.wcag_definition.report_boilerplate }}</p>
                                </td>
                                <td style="border:1px solid black;">
                                    <p>{{ check_result.page }}</p>
                                    <ul><li>{{ check_result.notes }}</li></ul>
                                </td>
                            </tr>
                            {% endfor %}
                    </tbody>
                </table>
                <h3 id="statement" class="govuk-heading-m">Accessibility statement</h3>
                <p class="govuk-body">{{ audit.get_accessibility_statement_state_display }}</p>
                {% if audit.accessibility_statement_state == 'found-but' %}
                    <ul class="govuk-list govuk-list--bullet">
                        {% for issue in audit.report_accessibility_issues %}
                            <li>{{ issue }}</li>
                        {% endfor %}
                    </ul>
                {% endif %}
                <h3 id="what-next" class="govuk-heading-m">What to do next</h3>
                <p class="govuk-body">
                    {% if audit.report_options_next == 'errors' %}
                        You should fix the issues that were found and do your own accessibility audit
                        to check for issues that go beyond the scope of simple accessibility testing.
                    {% else %}
                        You should do your own accessibility audit to check for issues that go beyond
                        the scope of simple accessibility testing.
                    {% endif %}
                </p>
                {% if audit.report_next_change_statement == 'yes' %}
                    <p class="govuk-body">
                        You need to review your accessibility statement to cover the issues found in
                        this report and any others found during your own audit.
                    </p>
                {% endif %}
                {% if audit.report_next_no_statement == 'yes' %}
                    <p class="govuk-body">
                        You need to write and publish an accessibility statement that meets the required
                        legislative format.
                    </p>
                {% endif %}
                {% if audit.report_next_statement_not_right == 'yes' %}
                    <p class="govuk-body">
                        You need to review your accessibility statement to cover the issues found in this report,
                        including ones related to your accessibility statement, and any other accessibility issues
                        found during your own site audit.
                    </p>
                {% endif %}
                {% if audit.report_next_statement_matches == 'yes' %}
                    <p class="govuk-body">
                        You need to review your accessibility statement to cover any other issues found during your
                        own audit.
                    </p>
                {% endif %}
                {% if audit.report_next_disproportionate_burden == 'yes' %}
                    <p class="govuk-body">
                        A disproportionate burden assessment must have been completed before adding this section to
                        your accessibility statement. You need to send evidence of the assessment to us for review.
                    </p>
                {% endif %}

                {% if audit.accessibility_statement_state == 'found-but' %}
                    <ul class="govuk-list govuk-list--bullet">
                        {% for issue in audit.report_accessibility_issues %}
                            <li>{{ issue }}</li>
                        {% endfor %}
                    </ul>
                {% endif %}
                <h3 id="all-issues" class="govuk-heading-m">All issues</h3>
                <table class="govuk-table" style="border:1px solid black;border-collapse:collapse;">
                    <thead>
                        <tr style="border:1px solid black;">
                            <th style="border:1px solid black;text-align:left;">Issue and description</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for wcag_definition in wcag_definitions %}
                            <tr style="border:1px solid black;">
                                <td style="border:1px solid black;">
                                    <p>
                                        {% if wcag_definition.url_on_w3 %}
                                            <a href="{{ wcag_definition.url_on_w3 }}" target="_blank">
                                                {{ wcag_definition }}</a>
                                        {% else %}
                                            {{ wcag_definition }}
                                        {% endif %}
                                    </p>
                                    <p class="cases-notes">{{ wcag_definition.report_boilerplate }}</p>
                                </td>
                            </tr>
                            {% endfor %}
                    </tbody>
                </table>

                <form method="post" action="{% url 'audits:edit-audit-report-text' audit.id %}">
                    {% csrf_token %}
                    <div class="govuk-grid-row">
                        <div class="govuk-grid-column-full">
                            {% include 'common/amp_form_snippet.html' %}
                        </div>
                        <div class="govuk-grid-column-full govuk-button-group">
                            <input type="submit" value="Save" name="save" class="govuk-button" data-module="govuk-button" />
                        </div>
                    </div>
                </form>
            </div>
            <div class="govuk-grid-column-one-third">
                {% include 'audits/helpers/nav_steps.html' with current_page='audits:edit-audit-report-text' %}
            </div>
        </div>
    </main>
</div>
{% endblock %}
