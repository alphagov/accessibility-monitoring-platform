<!DOCTYPE html>

{% extends 'base.html' %}

{% load humanize %}

{% block content %}
<div class="govuk-width-container">
    <main id="main-content" class="govuk-main-wrapper">
        <h1 class="govuk-heading-xl">{{ page_title }}</h1>
        <form action="{% url 'websites:website-list' %}" method="get" >
            <div class="govuk-grid-row query-form">
                <div class="govuk-grid-column-one-third">
                    <label class="govuk-label" for="{{ form.service.auto_id }}"><b>{{ form.service.label }}</b></label>
                    {{ form.service }}
                </div>
                <div class="govuk-grid-column-one-third">
                    <label class="govuk-label" for="{{ form.sector.auto_id }}"><b>{{ form.sector.label }}</b></label>
                    {{ form.sector }}
                </div>
                <div class="govuk-grid-column-one-third">
                    <label class="govuk-label" for="{{ form.location.auto_id }}"><b>{{ form.location.label }}</b></label>
                    {{ form.location }}
                </div>
            </div>
            <div class="govuk-grid-row">
                <div class="govuk-grid-column-one-third">
                    <label class="govuk-label" for="{{ form.start_date.auto_id }}"><b>{{form.start_date.label}}</b></label>
                    {% if form.start_date.errors %}
                        <span class="govuk-error-message">
                            <span class="govuk-visually-hidden">Error:</span> {{form.start_date.errors}}
                        </span>
                    {% endif %}
                    {{form.start_date}}
                </div>
                <div class="govuk-grid-column-one-third">
                    <label class="govuk-label" for="{{ form.end_date.auto_id }}"><b>{{form.end_date.label}}</b></label>
                    {% if form.end_date.errors %}
                        <span class="govuk-error-message">
                            <span class="govuk-visually-hidden">Error:</span> {{form.end_date.errors}}
                        </span>
                    {% endif %}
                    {{form.end_date}}
                </div>
                <div class="govuk-grid-column-one-third">
                    <label class="govuk-label" for="{{ form.sort_by.auto_id }}"><b>{{ form.sort_by.label }}</b></label>
                    {{form.sort_by}}
                </div>
            </div>
            <div class="form-group form-group--mb0--submit">
                <input type="submit" value="Submit" class="govuk-button" data-module="govuk-button"/>
                <input type="hidden" name="next" value="{{ next }}" />
            </div>
        </form>
        {% if websites %}
            <div class="govuk-grid-row">
                <div class="govuk-grid-column-one-half">
                    {% if page_obj.paginator.count %}
                        <h2 class="govuk-heading-l">{{ page_obj.paginator.count|intcomma }} websites found</h2>
                    {% elif url_parameters %}
                        <h2 class="govuk-heading-l">0 websites found</h2>
                    {% endif %}
                </div>
                <div class="govuk-grid-column-one-half">
                    {% if page_obj.paginator.count %}
                    <a
                        href="{% url 'websites:website-export-list' %}{% if url_parameters %}?{{ url_parameters }}{% endif %}"
                        role="button"
                        draggable="false"
                        class="govuk-button govuk-button--secondary"
                        data-module="govuk-button"
                    >
                        Export to CSV
                    </a>

                    {% endif %}
                </div>
            </div>
            {% include "common/pagination_controls.html" %}
            <table class="govuk-table">
            <thead class="govuk-table__head">
                <tr class="govuk-table__row">
                    <th scope="col" class="govuk-table__header">Service</th>
                    <th scope="col" class="govuk-table__header">Sector</th>
                    <th scope="col" class="govuk-table__header">Last updated</th>
                    <th scope="col" class="govuk-table__header">URL</th>
                    <th scope="col" class="govuk-table__header">Domain</th>
                    <th scope="col" class="govuk-table__header">HTML title</th>
                </tr>
            </thead>
                <tbody class="govuk-table__body">
                {% for website in websites %}
                    <tr class="govuk-table__row">
                        <td class="govuk-table__cell">{{website.service|truncatechars:30}}</td>
                        <td class="govuk-table__cell">{{website.sector.sector_name|truncatechars:30}}</td>
                        <td class="govuk-table__cell">{{website.last_updated|date:'d/m/Y'}}</td>
                        <td class="govuk-table__cell"><a href="{{website.url}}" >Link</a></td>
                        <td class="govuk-table__cell"><a href="https://{{website.original_domain}}">Link</a></td>
                        <td class="govuk-table__cell">{{website.htmlhead_title|truncatechars:20}}</td>
                    </tr>
                {% endfor %}
                </tbody>
            </table>
            {% include "common/pagination_controls.html" %}
        {% endif %}
    </main>
</div>
{% endblock %}
